<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
<id>vbgamer45:SMFTrader</id>
<version>1.1</version>

<file name="$languagedir/Modifications.english.php">
	<operation>
		<search position="after"><![CDATA[
?>]]></search>
		<add><![CDATA[
//Begin SMF Trader System Text Strings
$txt['smftrader_title'] = 'SMF Trader System';
$txt['smftrader_version'] = '1.1';
$txt['smftrader_admin'] = 'Trader Settings';
$txt['smftrader_guest'] = 'Guest';
//Display text strings
$txt['smftrader_profile'] = 'Trade Count: ';
//Profile text strings
$txt['smftrader_submitfeedback'] = 'Submit feedback for ';
$txt['smftrader_totalfeedback'] = 'Total  Positive Feedback: ';
$txt['smftrader_positivefeedbackpercent'] = 'Positive Feedback: ';
$txt['smftrader_positivefeedback'] = '<span style="color: #006400;">Positive Feedback: </span>';
$txt['smftrader_neutralfeedback'] = 'Neutral Feedback: ';
$txt['smftrader_negativefeedback'] = '<span style="color: #FF0000;">Negative Feedback: </span>';
//Start trader.template

//Submit Transaction Rating
$txt['smftrader_whoareu'] = 'You were the:';
$txt['smftrader_buyer'] = 'Buyer';
$txt['smftrader_seller'] = 'Seller';
$txt['smftrader_trade'] = 'Trade';


$txt['smftrader_transaction'] = 'Transaction Rating:';
$txt['smftrader_positive'] = 'Positive';
$txt['smftrader_neutral'] = 'Neutral';
$txt['smftrader_negative'] = 'Negative';

$txt['smftrader_shortcomment_small'] = 'Short Comment';
$txt['smftrader_shortcomment'] = 'Short comment on your transaction:';
$txt['smftrader_shortcommentnote'] = 'Max: 100 characters';
$txt['smftrader_topicurl'] = 'Topic URL:';
$txt['smftrader_longcomment'] = 'Long comment on your transaction:';


//Rating Overview
$txt['smftrader_allfeedback'] = 'View All Feedback';
$txt['smftrader_sellerfeedback'] = 'View Seller Feedback';
$txt['smftrader_buyerfeedback'] = 'View Buyer Feedback';
$txt['smftrader_tradefeedback'] = 'View Trade Feedback';

//Page Titles
$txt['smftrader_feedbacktitle'] = 'SMF Trader System - Trader Overview';
$txt['smftrader_submittitle'] = 'SMF Trader System - Submit Feedback';
$txt['smftrader_reporttitle'] = 'SMF Trader System - Report Bad Feedback';


$txt['smftrader_contact'] = 'Contact';
$txt['smftrader_viewprofile'] = 'View full profile.';
$txt['smftrader_sendpm'] = 'Send this user a personal message.';
//End trader.template

//Permissions
$txt['permissiongroup_smftrader'] = 'SMF Trader';
$txt['permissionname_smftrader_feedback'] = 'Allow submit feedback';
$txt['permissionhelp_smftrader_feedback'] = 'Allows the user to submit trader rating feedback.';
$txt['permissionname_smftrader_deletefeed'] = 'Allow delete ANY feedback by ANY user.';
$txt['permissionhelp_smftrader_deletefeed'] = 'Allows the user to delete feedback by anyone or anybody.';
$txt['cannot_smftrader_feedback'] = 'You are not allowed to submit feedback.';
$txt['cannot_smftrader_deletefeed'] = 'You are not allowed to delete feedback.';
$txt['permissionname_smftrader_autorating'] = 'Auto Approve Ratings';
$txt['permissionhelp_smftrader_autorating'] = 'Ratings do not need to wait for approval if this permission is given.';

//END SMF Trader System Text Strings			
]]></add>
	</operation>
</file>
<file name="$languagedir/Modifications.english-utf8.php" error="skip">
	<operation>
		<search position="after"><![CDATA[
?>]]></search>
		<add><![CDATA[
//Begin SMF Trader System Text Strings
$txt['smftrader_title'] = 'SMF Trader System';
$txt['smftrader_version'] = '1.1';
$txt['smftrader_admin'] = 'Trader Settings';
$txt['smftrader_guest'] = 'Guest';
//Display text strings
$txt['smftrader_profile'] = 'Trade Count: ';
//Profile text strings
$txt['smftrader_submitfeedback'] = 'Submit feedback for ';
$txt['smftrader_totalfeedback'] = 'Total  Positive Feedback: ';
$txt['smftrader_positivefeedbackpercent'] = 'Positive Feedback: ';
$txt['smftrader_positivefeedback'] = '<span style="color: #006400;">Positive Feedback: </span>';
$txt['smftrader_neutralfeedback'] = 'Neutral Feedback: ';
$txt['smftrader_negativefeedback'] = '<span style="color: #FF0000;">Negative Feedback: </span>';
//Start trader.template

//Submit Transaction Rating
$txt['smftrader_whoareu'] = 'You were the:';
$txt['smftrader_buyer'] = 'Buyer';
$txt['smftrader_seller'] = 'Seller';
$txt['smftrader_trade'] = 'Trade';


$txt['smftrader_transaction'] = 'Transaction Rating:';
$txt['smftrader_positive'] = 'Positive';
$txt['smftrader_neutral'] = 'Neutral';
$txt['smftrader_negative'] = 'Negative';

$txt['smftrader_shortcomment_small'] = 'Short Comment';
$txt['smftrader_shortcomment'] = 'Short comment on your transaction:';
$txt['smftrader_shortcommentnote'] = 'Max: 100 characters';
$txt['smftrader_topicurl'] = 'Topic URL:';
$txt['smftrader_longcomment'] = 'Long comment on your transaction:';


//Rating Overview
$txt['smftrader_allfeedback'] = 'View All Feedback';
$txt['smftrader_sellerfeedback'] = 'View Seller Feedback';
$txt['smftrader_buyerfeedback'] = 'View Buyer Feedback';
$txt['smftrader_tradefeedback'] = 'View Trade Feedback';

//Page Titles
$txt['smftrader_feedbacktitle'] = 'SMF Trader System - Trader Overview';
$txt['smftrader_submittitle'] = 'SMF Trader System - Submit Feedback';
$txt['smftrader_reporttitle'] = 'SMF Trader System - Report Bad Feedback';


$txt['smftrader_contact'] = 'Contact';
$txt['smftrader_viewprofile'] = 'View full profile.';
$txt['smftrader_sendpm'] = 'Send this user a personal message.';
//End trader.template

//Permissions
$txt['permissiongroup_smftrader'] = 'SMF Trader';
$txt['permissionname_smftrader_feedback'] = 'Allow submit feedback';
$txt['permissionhelp_smftrader_feedback'] = 'Allows the user to submit trader rating feedback.';
$txt['permissionname_smftrader_deletefeed'] = 'Allow delete ANY feedback by ANY user.';
$txt['permissionhelp_smftrader_deletefeed'] = 'Allows the user to delete feedback by anyone or anybody.';
$txt['cannot_smftrader_feedback'] = 'You are not allowed to submit feedback.';
$txt['cannot_smftrader_deletefeed'] = 'You are not allowed to delete feedback.';
$txt['permissionname_smftrader_autorating'] = 'Auto Approve Ratings';
$txt['permissionhelp_smftrader_autorating'] = 'Ratings do not need to wait for approval if this permission is given.';

//END SMF Trader System Text Strings			
]]></add>
	</operation>
</file>
<file name="$themedir/Profile.template.php">
	<operation>
	<search position="replace"><![CDATA[global $context, $settings, $options, $scripturl, $modSettings, $txt;

	// First do the containing table and table header.]]></search>
	<add><![CDATA[global $context, $settings, $options, $scripturl, $modSettings, $txt, $db_prefix;

	// First do the containing table and table header.]]></add>
	</operation>
	<operation>
	<search position="after"><![CDATA[echo '
					<td colspan="2"><hr size="1" width="100%" class="hrcolor" /></td>
				</tr>';

	// Show the users signature.]]></search>
	<add><![CDATA[
	// Start SMF Trader System
	global $sourcedir;
	include_once $sourcedir . '/Trader.php';
			
			
	$tradecount = GetTraderCount($context['member']['id']);
			
			
	GetTraderInformation($context['member']['id']);
	
	$context['neturalcount'] = 0;
	$context['pcount'] = 0;
	$context['ncount'] = 0;
	foreach($context['trader_mem_data'] as $row)
	{
		if ($row['salevalue'] == 0)
		{
			$context['pcount'] = $row['total'];
		}
		else if ($row['salevalue'] == 2)
		{
			$context['ncount'] = $row['total'];
		}	
		else if ($row['salevalue'] == 1)
		{
			$context['neturalcount'] = $row['total'];
		}
		
	}
	
	
	$context['tradecount_nonetural'] = ($context['pcount'] +  $context['ncount']);

	if ($modSettings['trader_use_pos_neg'])
		$tradecount = ($context['pcount'] -$context['ncount']);

	echo '<tr><td colspan="2"><hr size="1" width="100%" class="hrcolor" /></td></tr>
		<tr><td><b>' . $txt['smftrader_title'] . '</b></td></tr>
		<tr><td><b>' . $txt['smftrader_profile'] . '</b></td><td><b>(<a href="' . $scripturl .  '?action=trader&id=' . $context['member']['id'] . '">' . ($modSettings['trader_use_pos_neg'] ? ($tradecount > 0 ? '+' . $tradecount : $tradecount)  : $tradecount) . '</a>)</b></td></tr>
		<tr><td><b>' . $txt['smftrader_positivefeedbackpercent']  . '</b></td><td><b>' , $context['tradecount_nonetural'] != 0 ? round(($context['pcount'] / $context['tradecount_nonetural']) * 100, 2) : 0 , '%</b></td></tr>
		<tr><td>' . $txt['smftrader_positivefeedback'] . '</td><td>' . $context['pcount'] . '&nbsp;<img src="' .  $modSettings['smileys_url'] . '/default/smiley.gif" alt="positive" /></td></tr>
		<tr><td>' . $txt['smftrader_neutralfeedback']  . '</td><td>' .  $context['neturalcount'] . '&nbsp;<img src="' . $modSettings['smileys_url'] . '/default/undecided.gif" alt="neutral" /></td></tr>
		<tr><td>' . $txt['smftrader_negativefeedback']  . '</td><td>' .  $context['ncount'] . '&nbsp;<img src="' .  $modSettings['smileys_url'] . '/default/angry.gif" alt="negative" /></td></tr>
		<tr><td>' . $txt['smftrader_totalfeedback']  . '</td><td>' .  ($context['pcount'] - $context['ncount']) . '</td></tr>';
	
	global $ID_MEMBER;
	
		if ($ID_MEMBER !=  $context['member']['id'])
		echo '
		<tr><td colspan="2"><br /><a href="' . $scripturl .  '?action=trader&sa=submit&id=' . $context['member']['id'] . '">' . $txt['smftrader_submitfeedback'] . $context['member']['name'] . '</a></td></tr>';

	// END SMF Trader System
	]]></add>
	</operation>
</file>
<file name="$themedir/Display.template.php">
	<operation>
		<search position="before"><![CDATA[global $context, $settings, $options, $txt, $scripturl, $modSettings;]]></search>
		<add><![CDATA[
		global $db_prefix;]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[// Show the member's primary group (like 'Administrator') if they have one.
		if (isset($message['member']['group']) && $message['member']['group'] != '')
			echo '
								', $message['member']['group'], '<br />';]]></search>
		<add><![CDATA[
		// Start SMF Trader System
		if (!empty($message['member']['id']))
		{
		global $sourcedir;
		include_once $sourcedir . '/Trader.php';
				
		GetTraderInformation($message['member']['id']);
		
		$context['neturalcount'] = 0;
		$context['pcount'] = 0;
		$context['ncount'] = 0;
		foreach($context['trader_mem_data'] as $row)
		{
			if ($row['salevalue'] == 0)
			{
				$context['pcount'] = $row['total'];
			}
			else if ($row['salevalue'] == 2)
			{
				$context['ncount'] = $row['total'];
			}	
			else if ($row['salevalue'] == 1)
			{
				$context['neturalcount'] = $row['total'];
			}

		}
		
		
		
		
		if ($modSettings['trader_use_pos_neg'])
			$tradecount = ($context['pcount'] - $context['ncount']);
		else
			$tradecount = $context['pcount'] + $context['ncount'] + $context['neturalcount'];
		
		

		// Show the trader info
				echo '
					<b>' . $txt['smftrader_profile'] . ' </b>
					(<a href="' . $scripturl .  '?action=trader&id=' . $message['member']['id'] . '">', $modSettings['trader_use_pos_neg'] ? ($tradecount > 0 ? '+' . $tradecount : $tradecount)  : $tradecount  , '</a>)<br />';
		
		}
		//END SMF Trader System
		]]>
		</add>	
	</operation>
</file>

<file name="$boarddir/index.php">
	<operation>
		<search position="before"><![CDATA[
		'trackip' => array('Profile.php', 'trackIP'),]]></search>
		<add><![CDATA[		'trader' => array('Trader.php', 'tradermain'),]]></add>
	</operation>
</file>
<file name="$sourcedir/ManagePermissions.php">
	<operation>
		<search position="before"><![CDATA['pm' => array(
				'pm_read' => false,
				'pm_send' => false,
			),]]></search>
		<add><![CDATA[
'smftrader' => array(
				'smftrader_feedback' => false,
				'smftrader_deletefeed' => false,
				'smftrader_autorating' => false,
			),]]></add>
	</operation>
</file>
<file name="$sourcedir/Subs.php">
	<operation>
		<search position="before"><![CDATA['edit_settings' => '<a href="' . $scripturl . '?action=serversettings;sesc=' . $sc . '">' . $txt[222] . '</a>',]]></search>
	<add><![CDATA[
	'trader_settings' => '<a href="' . $scripturl . '?action=trader;sa=admin;sesc=' . $sc . '">' . $txt['smftrader_admin'] . '</a>',
]]></add>
	</operation>

</file>


<file name="$languagedir/Help.english.php">
	<operation>
		<search position="after"><![CDATA[
?>]]></search>
		<add><![CDATA[
//Begin SMF Trader System Text Strings

$helptxt['trader_approval'] = "
When checked: All ratings require approval before being posted unless they are in an autoapproved group found in permissions
<br /><br />
When unchecked: All ratings are auto approved since the ratings do not require approval.";

$helptxt['trader_use_pos_neg'] = "When enabled changes the trading count number to be a positive or negative figure based on the number of positive feedback minus the negative feedback. If it is a positive feedback number it results in a + (plus) in front of the number. If it is a negative feedback number results in a - (minus) in front the number.";

//END SMF Trader System Text Strings			
]]></add>
	</operation>
</file>

<file name="$languagedir/Help.english-utf8.php" error="skip">
	<operation>
		<search position="after"><![CDATA[
?>]]></search>
		<add><![CDATA[
//Begin SMF Trader System Text Strings

$helptxt['trader_approval'] = "
When checked: All ratings require approval before being posted unless they are in an autoapproved group found in permissions
<br /><br />
When unchecked: All ratings are auto approved since the ratings do not require approval.";

$helptxt['trader_use_pos_neg'] = "When enabled changes the trading count number to be a positive or negative figure based on the number of positive feedback minus the negative feedback. If it is a positive feedback number it results in a + (plus) in front of the number. If it is a negative feedback number results in a - (minus) in front the number.";


//END SMF Trader System Text Strings			
]]></add>
	</operation>
</file>
</modification>