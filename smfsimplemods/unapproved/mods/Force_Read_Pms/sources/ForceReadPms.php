<?php/*---------------------------------------------------------------------------------*	Force Read Pms														 		  **	Version 1.0																	  **	Author: 4kstore																  **	Copyright 2013												        		  **	Powered by www.smfsimple.com												  **********************************************************************************************************************************************************************/if (!defined('SMF'))	die('Hacking attempt...');function frp_admin_area(&$areas){	global $txt;		loadLanguage('ForceReadPms');	$areas['config']['areas']['modsettings']['subsections']['forcereadpm'] = array($txt['frp_admin']);}function frp_modify_modifications(&$sub_actions){	$sub_actions['forcereadpm'] = 'frp_settings';}function frp_settings(&$return_config = false){	global $context, $txt, $scripturl;		loadLanguage('ForceReadPms');	$context['page_title'] = $txt['frp_admin'];	$context['settings_title'] = $txt['frp_admin'];	$context['settings_message'] = $txt['frp_admin_desc'];	$context['post_url'] = $scripturl . '?action=admin;area=modsettings;save;sa=forcereadpm';	$config_vars = array(		array('check', 'frp_enabled'),		array('int', 'frp_min_mps', '33', 'subtext' => $txt['frp_min_mps_desc']),		array('text', 'frp_excludes_groups', '33', 'subtext' => $txt['frp_excludes_groups_desc']),	);	if ($return_config)		return $config_vars;	if (isset($_GET['save']))	{		if (!empty($_POST['frp_excludes_groups']))		{			$tmp = explode(',', $_POST['frp_excludes_groups']);			$tmp = array_unique(array_map('intval', $tmp));			$_POST['frp_excludes_groups'] = implode(',', $tmp);		}				if (empty($_POST['frp_min_mps']) || $_POST['frp_min_mps'] < 0)			$_POST['frp_min_mps'] = 1;					checkSession();		saveDBSettings($config_vars);		writeLog();	}	prepareDBSettingContext($config_vars);}function frp_load_theme(){	global $context, $modSettings, $user_info;	if (!empty($modSettings['frp_enabled']) && !$user_info['is_guest'])	{			$exclude = !empty($modSettings['frp_excludes_groups']) ? $modSettings['frp_excludes_groups'] : '';		$exclude_groups = explode(',',$exclude);				if (count(array_intersect($user_info['groups'], $exclude_groups)) == 0 && (($context['current_action'] != 'pm') || ($context['current_action'] == 'pm' && !empty($context['current_subaction']))) && !empty($modSettings['frp_min_mps']) && $user_info['unread_messages'] >= $modSettings['frp_min_mps'])				 redirectexit('action=pm');		}	}